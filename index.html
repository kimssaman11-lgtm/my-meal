<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ± ì‹¤ì‹œê°„ ì‹ë‹¨ ê´€ë¦¬</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #A8C5E5; --bg: #F8F9FA; --card: #FFFFFF; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h2 { font-size: 1.1rem; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .day { min-height: 60px; border: 1px solid #eee; border-radius: 8px; padding: 5px; font-size: 0.8rem; cursor: pointer; }
        .day.today { background: #eef7ff; border: 2px solid var(--primary); }
        .meal-item { background: var(--primary); color: white; border-radius: 3px; font-size: 0.7rem; margin-top: 2px; padding: 1px 3px; overflow: hidden; }
        /* ì…ë ¥ í¼ */
        .input-group { display: flex; gap: 5px; margin-bottom: 10px; }
        input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 8px; }
        button { padding: 8px 12px; border: none; border-radius: 8px; background: var(--primary); color: white; cursor: pointer; }
        .list-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .del-btn { color: #ff6b6b; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align:center; font-size: 1.4rem;">ğŸ± ìš°ë¦¬ì§‘ ì‹ë‹¨í‘œ</h1>
        
        <div class="card">
            <h2>ğŸ“… ì‹ë‹¨ ì¼ì •</h2>
            <div id="monthDisplay" style="text-align:center; font-weight:bold; margin-bottom:10px;"></div>
            <div class="calendar" id="calendar"></div>
        </div>

        <div class="card">
            <h2>ğŸ§Š ëƒ‰ì¥ê³  ì¬ë£Œ</h2>
            <div class="input-group">
                <input type="text" id="ingInput" placeholder="ì¬ë£Œ ì¶”ê°€...">
                <button onclick="addIng()">ì¶”ê°€</button>
            </div>
            <div id="ingList"></div>
        </div>

        <div class="card">
            <h2>ğŸ›’ ì¥ë³´ê¸° ë©”ëª¨</h2>
            <div class="input-group">
                <input type="text" id="shopInput" placeholder="ì‚´ ê²ƒ ì¶”ê°€...">
                <button onclick="addShop()">ì¶”ê°€</button>
            </div>
            <div id="shopList"></div>
        </div>
    </div>

    <div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; padding:20px;">
        <div class="card" style="width:100%; max-width:300px;">
            <h3 id="modalDate"></h3>
            <div class="input-group">
                <input type="text" id="mealInput" placeholder="ë©”ë‰´ ì…ë ¥...">
                <button onclick="addMeal()">ë“±ë¡</button>
            </div>
            <div id="modalMealList"></div>
            <button onclick="closeModal()" style="width:100%; background:#999; margin-top:10px;">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜… Firebase ì„¤ì • (ì‚¬ìš©ìë‹˜ì˜ ì •ë³´ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì„¸ìš”) â˜…â˜…â˜…
        const firebaseConfig = {
            apiKey: "AIzaSyCccZX14U_e9ggvAAN1-NTjRbYUgNpk96I",
            authDomain: "my-meal-data.firebaseapp.com",
            databaseURL: "https://my-meal-data-default-rtdb.firebaseio.com/",
            projectId: "my-meal-data",
            storageBucket: "my-meal-data.firebasestorage.app",
            messagingSenderId: "533061791898",
            appId: "1:533061791898:web:80d0f6f0e3ea7646d2af23"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let meals = {}, ingredients = [], shopping = [];
        let selectedDate = "";

        // ì‹¤ì‹œê°„ ë™ê¸°í™”
        db.ref('/').on('value', (snapshot) => {
            const data = snapshot.val() || {};
            meals = data.meals || {};
            ingredients = data.ingredients || [];
            shopping = data.shopping || [];
            renderAll();
        });

        function saveData() { db.ref('/').set({ meals, ingredients, shopping }); }

        function renderAll() {
            renderCalendar();
            renderList('ingList', ingredients, 'ingredients');
            renderList('shopList', shopping, 'shopping');
        }

        function renderCalendar() {
            const cal = document.getElementById('calendar');
            const now = new Date();
            document.getElementById('monthDisplay').innerText = `${now.getFullYear()}ë…„ ${now.getMonth()+1}ì›”`;
            cal.innerHTML = '';
            const lastDate = new Date(now.getFullYear(), now.getMonth()+1, 0).getDate();
            for(let d=1; d<=lastDate; d++) {
                const dateKey = `${now.getFullYear()}-${now.getMonth()+1}-${d}`;
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day' + (new Date().getDate()===d ? ' today' : '');
                dayDiv.innerHTML = `<b>${d}</b>`;
                if(meals[dateKey]) meals[dateKey].forEach(m => {
                    dayDiv.innerHTML += `<div class="meal-item">${m}</div>`;
                });
                dayDiv.onclick = () => openModal(dateKey);
                cal.appendChild(dayDiv);
            }
        }

        function openModal(date) {
            selectedDate = date;
            document.getElementById('modalDate').innerText = date;
            renderModalMeals();
            document.getElementById('modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        
        function addMeal() {
            const val = document.getElementById('mealInput').value;
            if(!val) return;
            if(!meals[selectedDate]) meals[selectedDate] = [];
            meals[selectedDate].push(val);
            document.getElementById('mealInput').value = '';
            renderModalMeals();
            saveData();
        }
        function renderModalMeals() {
            const list = document.getElementById('modalMealList');
            list.innerHTML = (meals[selectedDate] || []).map((m, i) => 
                `<div class="list-item">${m} <span class="del-btn" onclick="removeMeal(${i})">ì‚­ì œ</span></div>`).join('');
        }
        function removeMeal(i) { meals[selectedDate].splice(i, 1); renderModalMeals(); saveData(); }

        function addIng() { 
            const val = document.getElementById('ingInput').value;
            if(val) { ingredients.push(val); document.getElementById('ingInput').value = ''; saveData(); }
        }
        function addShop() { 
            const val = document.getElementById('shopInput').value;
            if(val) { shopping.push(val); document.getElementById('shopInput').value = ''; saveData(); }
        }
        function renderList(id, arr, type) {
            document.getElementById(id).innerHTML = arr.map((item, i) => 
                `<div class="list-item">${item} <span class="del-btn" onclick="removeItem('${type}', ${i})">ì‚­ì œ</span></div>`).join('');
        }
        function removeItem(type, i) {
            if(type==='ingredients') ingredients.splice(i, 1);
            else shopping.splice(i, 1);
            saveData();
        }
    </script>
</body>
</html>
